name: AgenticART

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  lint:
    name: Lint & Style
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: Install Linting Tools
        run: pip install ruff mypy types-paramiko types-requests types-PyYAML
        
      - name: Run Ruff Check
        run: ruff check .
        
      - name: Run Mypy (Type Check)
        run: mypy .

  test:
    name: Unit Tests (Mocked)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-mock pytest-cov
          
      - name: Run Pytest
        env:
          PYTHONPATH: .
          LLM_PROVIDER: mock  # Ensure tests don't try to call real APIs
        run: |
          # Run tests, ignoring those that require a live emulator
          pytest tests/ -v --ignore=tests/integration_emulator

  docker:
    name: Docker Build Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        
      - name: Build WebApp Image
        run: docker build -t llm-android-pentest-web .
        
      - name: Build Kali Environment (Check)
        # Verify the docker-compose setup is valid
        run: docker compose config
