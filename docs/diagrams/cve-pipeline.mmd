%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#fff', 'lineColor': '#4a9eff'}}}%%

flowchart LR
    subgraph INPUT["Device Fingerprint"]
        A1["Android Version: 11"]
        A2["API Level: 30"]
        A3["Security Patch: 2021-01-05"]
        A4["Kernel: 5.4.86"]
    end

    subgraph MATCHER["CVE Matcher"]
        direction TB
        B1["Version Filter"]
        B2["API Range Check"]
        B3["Patch Date Compare"]
        B4["Kernel Version Parse"]

        B1 --> B2 --> B3 --> B4
    end

    subgraph DATABASE["CVE Database"]
        C1["CVE-2022-0847<br/>Dirty Pipe<br/>API 30-32"]
        C2["CVE-2021-0920<br/>Unix GC UAF<br/>API 29-31"]
        C3["CVE-2019-2215<br/>Binder UAF<br/>API 26-29"]
        C4["CVE-2016-5195<br/>Dirty COW<br/>API 19-24"]
    end

    subgraph OUTPUT["Matched CVEs"]
        D1["[MATCH] CVE-2022-0847<br/>PUBLIC EXPLOIT"]
        D2["[MATCH] CVE-2021-0920<br/>POC AVAILABLE"]
        D3["[SKIP] CVE-2019-2215<br/>API too low"]
        D4["[SKIP] CVE-2016-5195<br/>API too low"]
    end

    subgraph EXPLOIT["Exploit Selection"]
        E1["kernel_exploits.py"]
        E2["dirty_pipe()"]
    end

    INPUT --> MATCHER
    MATCHER --> DATABASE
    DATABASE --> OUTPUT
    OUTPUT --> EXPLOIT

    style D1 fill:#2e7d32,stroke:#fff
    style D2 fill:#2e7d32,stroke:#fff
    style D3 fill:#b71c1c,stroke:#fff
    style D4 fill:#b71c1c,stroke:#fff
    style E2 fill:#4a9eff,stroke:#fff
