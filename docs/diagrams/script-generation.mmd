%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#fff', 'lineColor': '#4a9eff'}}}%%

sequenceDiagram
    autonumber

    participant U as User
    participant G as Script Generator
    participant L as LLM (Ollama)
    participant V as Validator
    participant E as Executor
    participant T as Target Device

    U->>G: "Extract boot image and patch with Magisk"

    Note over G: Load exploitation.md prompt

    G->>G: Build context:<br/>- Target: Android 14<br/>- Device: SM-S911B<br/>- Root: Available

    G->>L: Generate Python script for:<br/>"Extract boot image, patch with Magisk"

    L-->>G: ```python<br/>import subprocess<br/>...<br/>```

    G->>V: Validate generated script

    Note over V: Check for:<br/>- Dangerous patterns<br/>- Syntax errors<br/>- Required imports

    alt Validation Failed
        V-->>G: Issues found
        G->>L: Regenerate with fixes
        L-->>G: Fixed script
    end

    V-->>G: Validation passed

    G-->>U: Script ready for review

    U->>E: Execute script

    E->>E: Select mode:<br/>DRY_RUN / DOCKER / LIVE

    E->>T: adb push script.py
    E->>T: adb shell python script.py

    T-->>E: Execution output

    E-->>U: Result + Report
