# Purple Belt Challenges
# =============================================================================
# Purpose: 1-Day Vulnerability Exploitation
# Focus: Execute real CVEs with public POCs against target device
# =============================================================================
# Target: Android 11 (API 30) on Genymotion
# Prerequisite: Brown Belt (app security/pentesting skills)
# Leads to: Black Belt (vulnerability discovery)
# =============================================================================
#
# COMPLEXITY RATING (determines belt, NOT cvss):
#   1 - trivial:  Single command, no special knowledge
#   2 - low:      Few steps, basic knowledge required
#   3 - medium:   Multiple steps, moderate domain knowledge
#   4 - high:     Complex chain, deep technical knowledge
#   5 - expert:   Original research, precise timing, chaining required
#
# CVSS is included as METADATA for context only - it measures IMPACT,
# not exploitation difficulty. A CVSS 10.0 can be trivial to exploit.
# =============================================================================

device_requirements:
  target_android: 11
  target_api: 30
  security_patch_level: "2021-01-01"
  notes: |
    For meaningful 1-day testing, the device should NOT have the latest
    security patches. Use a Genymotion image with older patch level.

challenges:

# =============================================================================
# SYSTEM COMPONENT EXPLOITS
# =============================================================================

- id: purple_001
  name: "1-Day: CVE-2021-0313 - SystemUI DoS"
  description: |
    CVE-2021-0313: Denial of Service in System UI via malformed notification.

    A malformed notification with an excessively long text field can crash
    the SystemUI process, causing a denial of service.

    OBJECTIVE:
    1. Craft a notification that triggers the vulnerability
    2. Send it to the device
    3. Verify SystemUI crashes (PID changes)

    SUCCESS CRITERIA: SystemUI process restarts (PID changes after exploit)
  belt: purple
  script_type: adb

  # Exploitation complexity (determines belt level)
  exploitation_complexity:
    rating: 3  # medium
    rationale: "Requires crafting specific payload, but well-documented"
    required_skills:
      - android_intent_system
      - notification_api
      - process_monitoring
    steps_required: 4
    tools_needed: [adb]
    public_poc_available: true

  # CVSS metadata (context only - does NOT determine belt)
  cvss:
    score: 5.5
    severity: Medium
    vector: "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H"
    attack_vector: Local
    attack_complexity: Low
    privileges_required: None
    user_interaction: Required

  version_constraints:
    min_api: 26
    max_api: 30
    patched_after: "2021-01-01"

  inputs:
    cve_id: CVE-2021-0313
    cwe_id: CWE-400  # Uncontrolled Resource Consumption
    device_context:
      task: exploit system component vulnerability
      target: com.android.systemui
      impact: denial_of_service

  validation:
    type: output_contains
    expected: "SystemUI"

  hints:
    - "Get initial PID: adb shell pidof com.android.systemui"
    - "Use 'am' command to send broadcast/notification"
    - "Compare PID after trigger - change indicates crash+restart"
    - "Check logcat for crash: adb logcat -d | grep -i crash"

  kata_solution: |
    BEFORE=$(adb shell pidof com.android.systemui)
    # Trigger exploit
    AFTER=$(adb shell pidof com.android.systemui)
    [ "$BEFORE" != "$AFTER" ] && echo "SystemUI crashed - CVE-2021-0313"

  tags:
    - 1-day
    - cve-2021-0313
    - dos
    - systemui
    - android-11

- id: purple_002
  name: "1-Day: CVE-2021-0327 - AccountManager Bypass"
  description: |
    CVE-2021-0327: Authentication bypass in AccountManager.

    A vulnerability in AccountManager allows accessing accounts of other
    apps without proper authentication via intent redirection.

    OBJECTIVE:
    1. Enumerate accounts on device
    2. Exploit the bypass to access account data
    3. Extract account information without permission

    SUCCESS CRITERIA: Access account data without user consent prompt
  belt: purple
  script_type: multi

  exploitation_complexity:
    rating: 4  # high
    rationale: "Requires understanding intent redirection chain"
    required_skills:
      - android_intent_system
      - account_manager_internals
      - intent_redirection
      - frida_or_apk_crafting
    steps_required: 6
    tools_needed: [adb, frida]
    public_poc_available: false

  cvss:
    score: 7.8
    severity: High
    vector: "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H"
    attack_vector: Local
    attack_complexity: Low
    privileges_required: None
    user_interaction: Required

  version_constraints:
    min_api: 27
    max_api: 30
    patched_after: "2021-02-01"

  inputs:
    cve_id: CVE-2021-0327
    cwe_id: CWE-287  # Improper Authentication
    device_context:
      task: exploit authentication bypass
      target: android.accounts.AccountManager
      impact: privilege_escalation

  validation:
    type: output_contains
    expected: "Account"

  hints:
    - "Start with: adb shell dumpsys account"
    - "The bypass uses intent redirection through exported activities"
    - "Look for activities that handle account intents"
    - "Craft nested intent in extras to reach protected components"

  kata_solution: "Requires Frida or custom APK for full exploitation"

  tags:
    - 1-day
    - cve-2021-0327
    - privesc
    - accountmanager
    - android-11

- id: purple_003
  name: "1-Day: CVE-2021-0391 - Bluetooth Info Leak"
  description: |
    CVE-2021-0391: Information disclosure in Bluetooth stack.

    A vulnerability in the Bluetooth GATT implementation allows
    unauthorized access to connected device information.

    OBJECTIVE:
    1. Query Bluetooth state and paired devices
    2. Access protected attributes without BLUETOOTH_ADMIN
    3. Extract device MACs/names

    SUCCESS CRITERIA: Retrieve Bluetooth info without required permissions
  belt: purple
  script_type: adb

  exploitation_complexity:
    rating: 2  # low
    rationale: "Simple dumpsys command, no special crafting needed"
    required_skills:
      - adb_commands
      - bluetooth_basics
    steps_required: 2
    tools_needed: [adb]
    public_poc_available: true

  cvss:
    score: 5.5
    severity: Medium
    vector: "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N"
    attack_vector: Local
    attack_complexity: Low
    privileges_required: Low
    user_interaction: None

  version_constraints:
    min_api: 30
    max_api: 30
    patched_after: "2021-03-01"

  inputs:
    cve_id: CVE-2021-0391
    cwe_id: CWE-200  # Exposure of Sensitive Information
    device_context:
      task: exploit bluetooth info disclosure
      target: com.android.bluetooth
      impact: information_disclosure

  validation:
    type: output_contains
    expected: "Bluetooth"

  hints:
    - "Use: adb shell dumpsys bluetooth_manager"
    - "Check content providers: content query on bt providers"
    - "Paired device info in settings database"
    - "Look for MAC addresses in output"

  kata_solution: shell dumpsys bluetooth_manager

  tags:
    - 1-day
    - cve-2021-0391
    - info-leak
    - bluetooth
    - android-11

# =============================================================================
# MEDIA FRAMEWORK EXPLOITS
# =============================================================================

- id: purple_004
  name: "1-Day: CVE-2021-0397 - Media Framework RCE"
  description: |
    CVE-2021-0397: Remote Code Execution in Media Framework.

    A heap buffer overflow in the media framework can be triggered by
    a malformed media file, potentially leading to code execution.

    OBJECTIVE:
    1. Identify vulnerable media component
    2. Craft/obtain malformed media file
    3. Trigger crash in mediaserver
    4. Document crash location

    SUCCESS CRITERIA: SIGSEGV in mediaserver/mediaextractor
  belt: purple
  script_type: multi

  exploitation_complexity:
    rating: 5  # expert
    rationale: "Heap overflow requires precise POC, memory layout knowledge"
    required_skills:
      - heap_exploitation
      - media_framework_internals
      - crash_analysis
      - exploit_development
    steps_required: 8
    tools_needed: [adb, poc_file, gdb, logcat]
    public_poc_available: false  # Usually need to craft

  cvss:
    score: 9.8
    severity: Critical
    vector: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
    attack_vector: Network
    attack_complexity: Low
    privileges_required: None
    user_interaction: None
    note: "Critical CVSS but HIGH exploitation complexity - these are independent!"

  version_constraints:
    min_api: 27
    max_api: 30
    patched_after: "2021-02-01"

  inputs:
    cve_id: CVE-2021-0397
    cwe_id: CWE-787  # Out-of-bounds Write
    device_context:
      task: trigger media framework vulnerability
      target: mediaserver
      impact: remote_code_execution

  validation:
    type: regex_match
    pattern: "(SIGSEGV|Fatal signal|mediaserver.*crash)"

  hints:
    - "Push POC file: adb push poc.mp4 /sdcard/"
    - "Trigger: am start -t video/* -d file:///sdcard/poc.mp4"
    - "Monitor: adb logcat | grep -E 'SIGSEGV|Fatal'"
    - "Crash often in libstagefright.so"

  kata_solution: "Requires POC media file from public exploit DB"

  tags:
    - 1-day
    - cve-2021-0397
    - rce
    - media
    - critical
    - android-11

# =============================================================================
# CONTENT PROVIDER EXPLOITS
# =============================================================================

- id: purple_005
  name: "1-Day: CVE-2021-0437 - Settings Provider SQLi"
  description: |
    CVE-2021-0437: SQL Injection in Settings Provider.

    The Settings content provider is vulnerable to SQL injection through
    the 'where' clause parameter.

    OBJECTIVE:
    1. Query Settings provider normally
    2. Inject SQL via --where parameter
    3. Extract data beyond normal scope
    4. Demonstrate data exfiltration

    SUCCESS CRITERIA: Extract settings not normally accessible
  belt: purple
  script_type: adb

  exploitation_complexity:
    rating: 2  # low
    rationale: "Classic SQLi via content command, well-documented technique"
    required_skills:
      - sql_injection_basics
      - android_content_providers
      - adb_content_command
    steps_required: 3
    tools_needed: [adb]
    public_poc_available: true

  cvss:
    score: 7.8
    severity: High
    vector: "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
    attack_vector: Local
    attack_complexity: Low
    privileges_required: Low
    user_interaction: None

  version_constraints:
    min_api: 29
    max_api: 30
    patched_after: "2021-04-01"

  inputs:
    cve_id: CVE-2021-0437
    cwe_id: CWE-89  # SQL Injection
    device_context:
      task: exploit sql injection
      target: com.android.providers.settings
      impact: data_exfiltration

  validation:
    type: output_contains
    expected: "Row:"

  hints:
    - "Normal query: content query --uri content://settings/secure"
    - "Injectable param: --where"
    - "Try: --where \"1=1 OR name LIKE '%'\""
    - "Extract secure settings without proper access"

  kata_solution: |
    shell content query --uri content://settings/secure --where "1=1"

  tags:
    - 1-day
    - cve-2021-0437
    - sqli
    - content-provider
    - android-11

# =============================================================================
# INTENT REDIRECTION CHAIN
# =============================================================================

- id: purple_006
  name: "1-Day: Intent Redirection (CVE-2021-0314/0328/0329)"
  description: |
    Multiple Android 11 CVEs involve intent redirection:
    - CVE-2021-0314: Settings intent redirect
    - CVE-2021-0328: System component redirect
    - CVE-2021-0329: Framework redirect

    Intent redirection allows launching non-exported activities or
    accessing protected components through confused deputy attack.

    OBJECTIVE:
    1. Enumerate exported activities with implicit intent filters
    2. Find activities that forward intents
    3. Craft nested intent to reach protected target
    4. Demonstrate privilege escalation

    SUCCESS CRITERIA: Launch non-exported activity via redirect chain
  belt: purple
  script_type: adb

  exploitation_complexity:
    rating: 4  # high
    rationale: "Requires understanding Android intent system deeply, finding redirect chains"
    required_skills:
      - android_intent_system
      - component_analysis
      - intent_crafting
      - confused_deputy_attacks
    steps_required: 6
    tools_needed: [adb, drozer_optional]
    public_poc_available: partial

  cvss:
    score: 7.8
    severity: High
    vector: "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H"
    attack_vector: Local
    attack_complexity: Low
    privileges_required: None
    user_interaction: Required

  version_constraints:
    min_api: 30
    max_api: 30
    patched_after: "2021-03-01"

  inputs:
    cve_ids:
      - CVE-2021-0314
      - CVE-2021-0328
      - CVE-2021-0329
    cwe_id: CWE-926  # Improper Export of Android Components
    device_context:
      task: exploit intent redirection
      impact: privilege_escalation

  validation:
    type: output_contains
    expected: "Activity"

  hints:
    - "Find targets: dumpsys package | grep -B5 'action.VIEW'"
    - "Look for activities that handle arbitrary URIs"
    - "Nested intent in extras: --es intent_extra '...'"
    - "Intent format: intent:#Intent;component=pkg/.Activity;end"

  kata_solution: |
    shell dumpsys package | grep -B5 "android.intent.action.VIEW" | grep Activity

  tags:
    - 1-day
    - intent-redirection
    - confused-deputy
    - android-11

# =============================================================================
# BLUETOOTH EXPLOITS
# =============================================================================

- id: purple_007
  name: "1-Day: CVE-2020-0471 - Bluetooth SMP Bypass"
  description: |
    CVE-2020-0471: Bluetooth pairing bypass via SMP flaw.

    A flaw in the Secure Manager Protocol allows bypassing pairing
    verification under certain conditions.

    OBJECTIVE:
    1. Analyze Bluetooth SMP configuration
    2. Identify pairing state machine vulnerability
    3. Demonstrate bypass condition
    4. Show unauthorized pairing state

    SUCCESS CRITERIA: Document SMP vulnerability or achieve bypass
  belt: purple
  script_type: multi

  exploitation_complexity:
    rating: 5  # expert
    rationale: "Requires Bluetooth protocol knowledge, external hardware, timing"
    required_skills:
      - bluetooth_protocol
      - smp_state_machine
      - btsnoop_analysis
      - wireless_security
    steps_required: 10+
    tools_needed: [adb, bluetooth_device, btsnoop, wireshark]
    public_poc_available: false

  cvss:
    score: 6.5
    severity: Medium
    vector: "CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N"
    attack_vector: Adjacent  # Requires Bluetooth proximity
    attack_complexity: Low
    privileges_required: None
    user_interaction: None

  version_constraints:
    min_api: 26
    max_api: 30
    patched_after: "2021-01-01"

  inputs:
    cve_id: CVE-2020-0471
    cwe_id: CWE-287  # Improper Authentication
    device_context:
      task: analyze bluetooth smp bypass
      target: com.android.bluetooth
      impact: authentication_bypass

  validation:
    type: output_contains
    expected: "SMP"

  hints:
    - "Enable btsnoop: setprop persist.bluetooth.btsnoopenable true"
    - "Debug logs: dumpsys bluetooth_manager"
    - "SMP states visible in btsnoop capture"
    - "May require external Bluetooth device for full test"

  kata_solution: "Requires Bluetooth analysis tools and external device"

  tags:
    - 1-day
    - cve-2020-0471
    - bluetooth
    - smp
    - auth-bypass
    - android-11

# =============================================================================
# LIBRARY VULNERABILITIES
# =============================================================================

- id: purple_008
  name: "1-Day: CVE-2021-0341 - OkHttp Hostname Bypass"
  description: |
    CVE-2021-0341: Certificate hostname verification bypass in OkHttp.

    OkHttp versions before 4.9.1 don't properly verify certificate
    hostname, allowing MITM attacks.

    OBJECTIVE:
    1. Find apps using vulnerable OkHttp
    2. Setup MITM with mismatched certificate
    3. Intercept traffic from vulnerable app
    4. Prove MITM success

    SUCCESS CRITERIA: Capture HTTPS traffic via hostname bypass
  belt: purple
  script_type: frida

  exploitation_complexity:
    rating: 3  # medium
    rationale: "Requires identifying vulnerable apps, setting up MITM proxy"
    required_skills:
      - frida_basics
      - mitm_proxy_setup
      - ssl_certificate_handling
      - okhttp_internals
    steps_required: 5
    tools_needed: [adb, frida, mitmproxy]
    public_poc_available: true

  cvss:
    score: 7.4
    severity: High
    vector: "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N"
    attack_vector: Network
    attack_complexity: High  # Requires MITM position
    privileges_required: None
    user_interaction: None

  version_constraints:
    min_api: 21
    max_api: 30
    affected_packages: ["*"]
    notes: "Depends on app's OkHttp version, not Android version"

  inputs:
    cve_id: CVE-2021-0341
    cwe_id: CWE-295  # Improper Certificate Validation
    device_context:
      task: exploit okhttp hostname bypass
      target: okhttp
      impact: mitm

  validation:
    type: output_contains
    expected: "intercepted"

  hints:
    - "Enumerate OkHttp versions via Frida"
    - "Hook OkHttpClient to check version class"
    - "Setup mitmproxy with wrong-domain cert"
    - "Vulnerable apps connect despite mismatch"

  kata_solution: |
    Java.perform(function() {
        try {
            var Platform = Java.use('okhttp3.internal.platform.Platform');
            console.log('[+] OkHttp present - check version');
        } catch(e) {
            console.log('[-] OkHttp not found');
        }
    });

  tags:
    - 1-day
    - cve-2021-0341
    - mitm
    - okhttp
    - android-11

# =============================================================================
# KERNEL/DRIVER EXPLOITS
# =============================================================================

- id: purple_009
  name: "1-Day: CVE-2020-0423 - Binder Use-After-Free"
  description: |
    CVE-2020-0423: Use-after-free in Binder driver.

    A use-after-free vulnerability in the Binder driver can be triggered
    by a race condition in transaction handling.

    OBJECTIVE:
    1. Identify Binder interface
    2. Analyze transaction handling
    3. Attempt to trigger race condition
    4. Document crash or behavior

    SUCCESS CRITERIA: Trigger crash in Binder or document vulnerability
  belt: purple
  script_type: multi

  exploitation_complexity:
    rating: 5  # expert
    rationale: "Kernel UAF requires precise timing, race condition, exploit dev skills"
    required_skills:
      - kernel_exploitation
      - binder_internals
      - race_condition_exploitation
      - c_programming
      - memory_corruption
    steps_required: 15+
    tools_needed: [adb, ndk, gdb, custom_c_code]
    public_poc_available: partial

  cvss:
    score: 7.8
    severity: High
    vector: "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
    attack_vector: Local
    attack_complexity: Low  # CVSS says low, but exploitation is HIGH
    privileges_required: Low
    user_interaction: None
    note: "CVSS AC:L but actual exploitation requires expert skills"

  version_constraints:
    min_api: 26
    max_api: 30
    patched_after: "2020-10-01"

  inputs:
    cve_id: CVE-2020-0423
    cwe_id: CWE-416  # Use After Free
    device_context:
      task: exploit binder vulnerability
      target: /dev/binder
      impact: privilege_escalation

  validation:
    type: regex_match
    pattern: "(binder|SIGSEGV|use.after.free)"

  hints:
    - "Binder accessed via /dev/binder"
    - "Use service list to find targets"
    - "Race condition in BC_FREE_BUFFER handling"
    - "Monitor dmesg for kernel crashes"

  kata_solution: "Requires custom C exploit code"

  tags:
    - 1-day
    - cve-2020-0423
    - binder
    - uaf
    - kernel
    - android-11

- id: purple_010
  name: "1-Day: CVE-2021-0399 - Framework Privilege Escalation"
  description: |
    CVE-2021-0399: Privilege escalation in Android Framework.

    A vulnerability in the Android Framework allows escalating privileges
    through improper permission checking.

    OBJECTIVE:
    1. Identify vulnerable framework component
    2. Craft exploit to bypass permission check
    3. Escalate to higher privilege level
    4. Demonstrate elevated access

    SUCCESS CRITERIA: Perform action requiring higher privileges
  belt: purple
  script_type: multi

  exploitation_complexity:
    rating: 4  # high
    rationale: "Requires framework internals knowledge, permission system understanding"
    required_skills:
      - android_framework
      - permission_system
      - service_interaction
      - binder_calls
    steps_required: 7
    tools_needed: [adb, frida]
    public_poc_available: false

  cvss:
    score: 7.8
    severity: High
    vector: "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
    attack_vector: Local
    attack_complexity: Low
    privileges_required: Low
    user_interaction: None

  version_constraints:
    min_api: 30
    max_api: 30
    patched_after: "2021-02-01"

  inputs:
    cve_id: CVE-2021-0399
    cwe_id: CWE-269  # Improper Privilege Management
    device_context:
      task: exploit framework privesc
      impact: privilege_escalation

  validation:
    type: output_contains
    expected: "privilege"

  hints:
    - "Framework services accessible via service call"
    - "Look for permission bypass in system_server"
    - "Analyze with: dumpsys activity services"
    - "Some services have improper caller checks"

  kata_solution: "Requires detailed framework analysis"

  tags:
    - 1-day
    - cve-2021-0399
    - framework
    - privesc
    - android-11
